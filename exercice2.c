/* Ecrire un programme basé sur 3 processus (P1, P2 et P3) ayant pour tâche :
* (P1) gérer le terminal :
* Lire deux nombres n et max au clavier et les émettre vers P2,
* Recevoir un paquet de nombres de P3 et l'afficher sur le terminal.
* (P2) générer des nombres aléatoires :
* Recevoir le nombre n de nombres à générer, la valeur depuis P1 et les émettre vers P3.
* (P3) trier dans l'ordre croissant des nombres :
* Lire le paquet de n nombres provenant de P2, le trier et l'envoyer à P1.
La terminaison s'effectuera par la lecture de la valeur 0 au clavier pour n.
*/
/*
/ @Author  Maha EL HANAFI 
*/



#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <errno.h>
#include <time.h>
#include <sys/wait.h>
int main(int argc, char *argv[])
{
    
    srand (time(NULL));
    pid_t fils1;
    pid_t fils2;
    int pipe[2],pipe2[2], pipe3[2];
    int n, max;
    pipe(pipe3);
    pipe(pipe1);
    fils1 = fork();
    int i,j;
    int a, b;
    int array [a];
    if (fils1 == 0)   /*first son*/
    {
        //fermeture de l'entrée standard
        close(pipe1[1]);

        read(pipe1[0], &a, sizeof(int));
        read(pipe1[0], &b, sizeof(int));
        //generer le nombre aleatoirement
        for (i = 0; i < a; i++)
        {
            array[i] = rand() % b;
        
        }
        close(pipe1[0]);
        //femeteure de l'entre standard
        close(1);
        //duplication de fd [1] avec la sortie standard
        dup(pipe1[1]);

        pipe(pipe2);
        fils2 = fork();

        if (fils2 == 0)    /*second son*/
        {
            for (int i = 0; i < a; i++)
            {
        close(pipe2[1]);
        //femeteure de l'entre standard
        close(0);
        //duplication de fd [0] avec la sortie standard
        dup(pipe2[0]);

        
                read(pipe2[0], &array[i], sizeof(int));
            }
            /* une varaible qui va nous aider a faire le tri*/
            int temp;
            for (int i = 0; i < a; i++)
            {
                for (int j = 0; j < a; j++)
                {
                    if (array[j] > array[j + 1])
                    {
                        temp = larray[j];
                        array[j] = array[j + 1];
                        array [j + 1] = temp;
                    }
                }
            }
            
            write(pipe3[1], &a, sizeof(int));
            for (int i = 0; i < a; i++)
            {
                write(pipe3[1], &array[i], sizeof(int));
            }


        }
        else
        {
            for (int i = 0; i < a; i++)
            {
                write(pipe2[1], &array[i], sizeof(int));
            }
        }
    }
    else  /*father*/
    {

        printf(" n :");
        scanf("%d", &n);
        printf(" max:");
        scanf("%d", &max);
        write(pipe1[1], &n, sizeof(int));
        write(pipe1[1], &max, sizeof(int));
        read(pipe3[0], &a, sizeof(int));
        for (int i = 0; i < a; i++)
            {
                read(pipe3[0], &array[i], sizeof(int));
            }
        for (int i = 0; i < a; i++)
            {
                printf("%d  ", array[i]);
            }    
             printf("\n  ");
    }
    return 0;
}