/* Le programme ping.c envoie une requête de type a + b, a*b, a/b, dans le tube pi2po 
*
*/
/* @Author  Maha EL HANAFI 
*/

/* En utilisant les tubes nommés, on cree les fifos 
le premier processus retourne une requete de type soit a+b, a*b 
 * Cree les fifos cli2serv et serv2cli
 * LANCER LE SERVEUR D'ABORD (car il ecrase fifos)
 */

#include <sys/types.h>
#include <fcntl.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#define  PI1PO "pros2pros1"
#define  PI2PO "pros2pros1"

/*traitement du premier processus*/
void traitement();             

main()
{
    int fdq, fdr;
    unlink(PI1PO);
    unlink(REPONSE);
/* creation des fifos utilisant la fonction mkfifo et en passant deux parametre 
* nom de tube et les permissions accordés au tubes */
    if (mkfifo(PI1PO, 0644) == -1 ||
        mkfifo(PI2PO, 0644) == -1) {
        perror("Impossible de creer les fifos");
        exit(2);
    }
/* Attente des ouvertures deuxieme processus */

    fdq = open(PI1PO, O_RDONLY);
    fdr = open(PI2PO, O_WRONLY);
    trait(fdr, fdq);
    close(fdq);
    close(fdr);
    unlink(PI1PO);
    unlink(PI2PO);
    exit(0);
}


void traitement(fdr, fdq)
int fdr, fdq;
/* fdr et fdq descripteurs reponse/question */
{
    int opd1, opd2, res;
    char opr;
    char quest[11];
    char rep[11];

/* traitement prmier processus 
   * envoi reponse a question
   * a + b venant de premier processus.
   * arret question = "Ciao"
 */

    while (1) {
        read(fdq, quest, 10);
        sscanf(quest, "%d%1s%d", &opd1, &opr, &opd2);
        if (strcmp(quest, "Ciao") == 0) {
            strcpy(rep, "Bye");
            write(fdr, rep, 10);
            break;
        }
        res = opd1 + opd2;
        sprintf(rep, "%d", res);
        write(fdr, rep, 10);

        /*if(opr = "+")
        {res = opd1 + opd2;} 
        if(opr = "*")
        {res = opd1 * opd2;} 
        if(opr = "/")
        {  if (opd2 !=0)
        res = opd1 + opd2;} 
 */
    }
}

/*
#include <sys/types.h>
#include <fcntl.h>
#include <string.h>
#include <stdio.h>
#include <sys/stat.h> 

//le code du premier processus 

int main()
{
	
	char monTube[] ="this is a pipe";
	/*la variable est définit par messageEcrire qui prend la taille 100 puis en affectant le message "hello"
	 *dont le premier processus va envoyer à le deuxieme processus 
     char messageEcrice [100] ="hello"; 

	/*creation des fifos utilisant la fonction mkfifo et en passant deux parametre
	*nom de tube et les permissions accordés au tubes
	mkfifo(monTube, 0644);

	//définir le type d'acces qui a le processus
    int desc=open(monTube, O_WRONLY)


}*/