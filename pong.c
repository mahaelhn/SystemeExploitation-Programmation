 /*Le programme pong.c lui retourne la réponse dans le tube po2pi
 Le programme pong.c crée les tubes et les supprime en fin d'exécution */


/* prosessus2: envoie expressions
   * Les fifos sont supposes crees
   * par le processus 1 et sont pros2pros1
   * et pros1pros2
 */

#include <sys/types.h>
#include <fcntl.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#define  PI1PO "pros2pros1"
#define  PI2PO "pros1pros2"

/*traitament du deuxieme processus*/
void traitement();  

main()
{
    int fdq, fdr;
    fdq = open(PI1PO, O_WRONLY);
    if (fdq == -1) {
        fprintf(stderr, "Impossible ouvrire fifo %s\n", PI1PO);
        fprintf(stderr, "Lancer le premier processus d\'abord?\n");
        exit(2); }
    fdr = open(PI2PO, O_RDONLY);
    if (fdr == -1) {
        fprintf(stderr, "Impossible ouvrire fifo %s\n", PI2PO);
        fprintf(stderr, "Lancer le premier processus d\'abord?\n");
        exit(2);
    }
    traitement(fdr, fdq);
    close(fdq);
    close(fdr);
    exit(0);
}

void traitement(fdr, fdq)
int fdr, fdq;
/* fdr et fdq descripteurs reponse/question */
{
    char rep[11];
    char quest[10];
/* traitement client
   * lecture expression a op b
   * dans stdin et ecriture reponse
   * dans stdout. Arret rep = "Bye"
 */
    while (1) {
        if (fgets(quest, sizeof(quest), stdin) == NULL)
            exit(2);
        write(fdq, quest, 10);
        printf("processus 2: %s \n", quest);
        read(fdr, rep, 10);
        printf("Processus 1 : %s \n", rep);
        if (strcmp(rep, "Bye") == 0)
            break;
    }
}